"use strict";const{html:html,render:render,useEffect:useEffect,useRef:useRef,useState:useState,useContext:useContext,createContext:createContext}=window.htmPreact;function useDependencies({componentName:e,jsDependencies:t,cssDependencies:n}){const o=useContext(DependencyLoader),c=useRef(0==t.length),i=useRef(0==n.length);return useEffect((()=>{!0!==o.canRender[e]&&!0!==o.isLoadingDependencies.current[e]&&(o.isLoadingDependencies.current={...o.isLoadingDependencies.current,[e]:!0},t.forEach(((n,d)=>{const s=document.createElement("script");s.src=n,s.type="text/javascript",s.async=!1,s.onload=()=>{d==t.length-1&&(i.current&&o.setCanRender((t=>({...t,[e]:!0}))),c.current=!0)},document.head.appendChild(s)})),n.forEach(((t,d)=>{const s=document.createElement("link");s.href=t,s.rel="stylesheet",s.async=!1,s.onload=()=>{d==n.length-1&&(c.current&&o.setCanRender((t=>({...t,[e]:!0}))),i.current=!0)},document.head.appendChild(s)})))}),[e,n,o,t]),o.canRender[e]}const dictComponent={};function BokehContent({spec:e,content_uuid:t,external_js_dependencies:n,external_css_dependencies:o}){const c=useDependencies({componentName:"BokehContent",jsDependencies:n,cssDependencies:o}),i=useRef(null);return useEffect((()=>{i.current&&t&&c&&window.Bokeh.embed.embed_item(e,t)}),[i,t,c,e]),html`<div id="${t}" ref="${i}" />`}function VegaContent({spec:e,content_uuid:t,external_js_dependencies:n,external_css_dependencies:o}){const c=useRef(null),i=useDependencies({componentName:"VegaContent",jsDependencies:n,cssDependencies:o});return useEffect((()=>{c.current&&t&&i&&(e.config.width="container",e.config.height="container",window.vegaEmbed("#".concat(t),e).catch(console.error))}),[c,t,i,e]),html`<div id="${t}" ref="${c}" />`}function MarkdownText({text:e}){const t=useRef(null);return useEffect((()=>{window.snarkdown&&t.current&&(t.current.innerHTML=window.snarkdown(e))}),[e]),html`<div ref="${t}" />`}function SVGContainer({data:e}){const t=useRef(null);return useEffect((()=>{t.current&&(t.current.innerHTML=e)}),[e]),html`<div ref="${t}" />`}function TableContent({data:e,columns:t,content_uuid:n,external_js_dependencies:o,external_css_dependencies:c}){const i=useRef(null),d=useDependencies({componentName:"TableContent",jsDependencies:o,cssDependencies:c});return useEffect((()=>{i.current&&n&&d&&new window.Tabulator(`#${n}`,{data:e.map(((e,t)=>({id:t,...e}))),columns:t.map((e=>({field:e,title:e}))),layout:"fitColumns",height:"30vh"})}),[i,n,d,t,e]),html`<div ref=${i} id="${n}"></div>`}function SVGContent({data:e}){return html`<${SVGContainer} data="${e}" />`}function FallbackContent({detected_type:e}){return html`<p class="vz-text">Unknown content type "${e}"</p>`}function WidgetContent({content:e}){const{component:t,...n}=e;return html` <div class="vz-widget-content">
    ${dictComponent[t]?html`<${dictComponent[t]} ...${n} />`:html`<p class="vz-text">Component has no renderable content.</p>`}
  </div>`}function Widget({widgetSpec:e}){const{name:t,description:n,content:o}=e;return html` <div class="vz-widget">
    ${t?html`<h3>${t}</h3>`:null}
    <${WidgetContent} content=${o} />
    ${n?html`<div class="vz-description">
          <${MarkdownText} text=${n} />
        </div>`:null}
  </div>`}function Header({headerSpec:e}){const{name:t,description:n}=e;return html` <div class="vz-header">
    ${t?html`<h2>${t}</h2>`:null}
    <hr />
    ${n?html`<div class="vz-text"><${MarkdownText} text=${n} /></div>`:null}
  </div>`}function TextElement({textSpec:e}){const{text:t}=e;return html` <div class="vz-text-element">
    <${MarkdownText} text=${t} />
  </div>`}function ViznoElement({element:e}){const{element_type:t}=e;return html`<div class="vz-element">
    ${"widget"===t?html` <${Widget} widgetSpec=${e} />`:"header"===t?html`<${Header} headerSpec=${e} />`:"text"===t?html`<${TextElement} textSpec=${e} />`:null}
  </div>`}dictComponent.BokehContent=BokehContent,dictComponent.VegaContent=VegaContent,dictComponent.MarkdownText=MarkdownText,dictComponent.TableContent=TableContent,dictComponent.SVGContent=SVGContent,dictComponent.FallbackContent=FallbackContent;const widthToPureClass=[null,"1-12","1-6","1-4","1-3","5-12","1-2","7-12","2-3","3-4","5-6","11-12","1-1"];function WidgetLayout({elements:e}){let t=[],n=0,o=[];for(let c of e)"header"!==c.element_type&&n+c.layout.width<=12&&!c.layout.newline?(t=[...t,c],n+=c.layout.width):(o=[...o,t],n=c.layout.width,t=[c]);return t.length&&(o=[...o,t]),html`${o.map((e=>html`<div class="pure-g">
        ${e.map((e=>html` <div class="pure-u-${widthToPureClass[e.layout.width]}">
            <${ViznoElement} element=${e} />
          </div>`))}
      </div>`))}`}function VizApp({pageTitle:e,dateTime:t,description:n,elements:o}){return html`
    <title>${e}</title>
    <div class="vz-body">
      <div class="vz-titlesection">
        <h1>${e}</h1>
        <div class="vz-datetime"><p>${t}</p></div>
      </div>
      ${n?html`<div class="vz-report-description vz-element">
            <${MarkdownText} text=${n} />
          </div>`:null}
      <div class="vz-widget-body">
        <${WidgetLayout} elements=${o} />
      </div>
    </div>
  `}const DependencyLoader=createContext({});function App(){const[e,t]=useState(null),[n,o]=useState(null),c=useRef({}),[i,d]=useState({});return useEffect((()=>{if(n){const e=n.get("configurationRequestURL");n.delete("configurationRequestURL"),fetch(`${e}?${n.toString()}`,{headers:{"content-type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>t(e)))}}),[n]),useEffect((()=>{if(window.location.search){let e=new URLSearchParams(window.location.search);e.has("configurationRequestURL")&&o(e)}else{const e=document.createElement("script");e.src="./vizno-config.js",e.type="text/javascript",e.async=!1,e.onload=()=>{t(window.configuration)},document.head.appendChild(e)}}),[]),e?html` <${DependencyLoader.Provider} value=${{isLoadingDependencies:c,canRender:i,setCanRender:d}}><${VizApp}
        pageTitle="${e.title}"
        dateTime=${e.datetime}
        description=${e.description}
        elements=${e.elements}
      /></${DependencyLoader}>`:html`Loading configuration...`}render(html` <${App} /> `,document.getElementById("root"));
