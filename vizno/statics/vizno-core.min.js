"use strict";const{useEffect:useEffect,useRef:useRef,useContext:useContext,createContext:createContext}=window.htmPreact,DependencyLoader=createContext({});function useDependencies({componentName:e,jsDependencies:n,cssDependencies:t}){const o=useContext(DependencyLoader),c=useRef(0==n.length),s=useRef(0==t.length);return useEffect((()=>{!0!==o.canRender[e]&&!0!==o.isLoadingDependencies.current[e]&&(o.isLoadingDependencies.current={...o.isLoadingDependencies.current,[e]:!0},n.forEach(((t,i)=>{const d=document.createElement("script");d.src=t,d.type="text/javascript",d.async=!1,d.onload=()=>{i==n.length-1&&(s.current&&o.setCanRender((n=>({...n,[e]:!0}))),c.current=!0)},document.head.appendChild(d)})),t.forEach(((n,i)=>{const d=document.createElement("link");d.href=n,d.rel="stylesheet",d.async=!1,d.onload=()=>{i==t.length-1&&(c.current&&o.setCanRender((n=>({...n,[e]:!0}))),s.current=!0)},document.head.appendChild(d)})))}),[e,t,o,n]),o.canRender[e]}const{html:html,useEffect:useEffect$1,useRef:useRef$1}=window.htmPreact,dictComponent={};function BokehContent({spec:e,content_uuid:n,external_js_dependencies:t,external_css_dependencies:o}){const c=useDependencies({componentName:"BokehContent",jsDependencies:t,cssDependencies:o}),s=useRef$1(null);return useEffect$1((()=>{s.current&&n&&c&&window.Bokeh.embed.embed_item(e,n)}),[s,n,c,e]),html`<div id="${n}" ref="${s}" />`}function VegaContent({spec:e,content_uuid:n,external_js_dependencies:t,external_css_dependencies:o}){const c=useRef$1(null),s=useDependencies({componentName:"VegaContent",jsDependencies:t,cssDependencies:o});return useEffect$1((()=>{c.current&&n&&s&&(console.log(e),e.height="container",e.width="container",window.vegaEmbed("#".concat(n),e).catch(console.error))}),[c,n,s,e]),html`<div
    id="${n}"
    ref="${c}"
    style="width: 100%; height:40vh"
  />`}function MarkdownText({text:e}){const n=useRef$1(null);return useEffect$1((()=>{window.snarkdown&&n.current&&(n.current.innerHTML=window.snarkdown(e))}),[e]),html`<div ref="${n}" />`}function SVGContainer({data:e}){const n=useRef$1(null);return useEffect$1((()=>{n.current&&(n.current.innerHTML=e)}),[e]),html`<div ref="${n}" />`}function TableContent({data:e,columns:n,content_uuid:t,external_js_dependencies:o,external_css_dependencies:c}){const s=useRef$1(null),i=useDependencies({componentName:"TableContent",jsDependencies:o,cssDependencies:c});return useEffect$1((()=>{s.current&&t&&i&&new window.Tabulator(`#${t}`,{data:e.map(((e,n)=>({id:n,...e}))),columns:n.map((e=>({field:e,title:e}))),layout:"fitColumns",height:"30vh"})}),[s,t,i,n,e]),html`<div ref=${s} id="${t}"></div>`}function SVGContent({data:e}){return html`<${SVGContainer} data="${e}" />`}function CodeContent({external_js_dependencies:e,external_css_dependencies:n,code:t,language:o}){const c=useDependencies({componentName:"CodeContent",jsDependencies:e,cssDependencies:n}),s=useRef$1(null),i=useRef$1(!1);return useEffect$1((()=>{c&&s.current&&!i.current&&(s.current.innerHTML=window.hljs.highlight(o,t).value,i.current=!0)})),html`<pre><code ref=${s}></code></pre>`}function LatexContent({external_js_dependencies:e,external_css_dependencies:n,text:t}){if(useDependencies({componentName:"LatexContent",jsDependencies:e,cssDependencies:n}))return customElements.define("latex-js",window.latexjs.LaTeXJSComponent),html`<latex-js baseURL="https://cdn.jsdelivr.net/npm/latex.js/dist/"
      >${t}</latex-js
    >`}function MathJaxContent({external_js_dependencies:e,external_css_dependencies:n,text:t}){const o=useDependencies({componentName:"MathJaxContent",jsDependencies:e,cssDependencies:n}),c=useRef$1(null),s=useRef$1(!1);return useEffect$1((()=>{o&&window.MathJax&&s.current&&!s.current&&(window.MathJax.typeset((()=>c.current)),s.current=!0)})),html`<div ref=${c}>${t}</div>`}function PlotlyComponent({content_uuid:e,spec:n,external_js_dependencies:t,external_css_dependencies:o}){const c=useDependencies({componentName:"PlotlyComponent",jsDependencies:t,cssDependencies:o}),s=useRef$1(null);return useEffect$1((()=>{c&&window.Plotly&&window.Plotly.react(e,n.data,n.layout,{responsive:!0})})),html`<div ref=${s} id=${e} />`}function FallbackContent({detected_type:e}){return html`<p class="vz-text">Unknown content type "${e}"</p>`}function VZCustomComponent({component:e,spec:n}){const{component_module:t,external_js_dependencies:o,external_css_dependencies:c,...s}=n;return useDependencies({componentName:e,jsDependencies:[...o,t],cssDependencies:c})?html`<${window[e]} ...${s} />`:html`<p class="vz-text">
        Could not resolve custom component ${e} from module
        ${t}
      </p>`}function WidgetContent({content:e}){const{component:n,...t}=e;return html` <div class="vz-widget-content">
    ${dictComponent[n]?html`<${dictComponent[n]} ...${t} />`:t.component_module?html`<${VZCustomComponent} component=${n} spec=${t} />`:html`<p class="vz-text">Component has no renderable content.</p>`}
  </div>`}dictComponent.BokehContent=BokehContent,dictComponent.VegaContent=VegaContent,dictComponent.MarkdownText=MarkdownText,dictComponent.TableContent=TableContent,dictComponent.SVGContent=SVGContent,dictComponent.CodeContent=CodeContent,dictComponent.LatexContent=LatexContent,dictComponent.MathJaxContent=MathJaxContent,dictComponent.PlotlyComponent=PlotlyComponent,dictComponent.FallbackContent=FallbackContent;const{html:html$1}=window.htmPreact;function Widget({widgetSpec:e}){const{name:n,description:t,content:o}=e;return html$1` <div class="vz-widget">
    ${n?html$1`<h3>${n}</h3>`:null}
    <${WidgetContent} content=${o} />
    ${t?html$1`<div class="vz-description">
          <${MarkdownText} text=${t} />
        </div>`:null}
  </div>`}function Header({headerSpec:e}){const{name:n,description:t}=e;return html$1` <div class="vz-header">
    ${n?html$1`<h2>${n}</h2>`:null}
    <hr />
    ${t?html$1`<div class="vz-text"><${MarkdownText} text=${t} /></div>`:null}
  </div>`}function TextElement({textSpec:e}){const{text:n}=e;return html$1` <div class="vz-text-element">
    <${MarkdownText} text=${n} />
  </div>`}function ViznoElement({element:e}){const{element_type:n}=e;return"widget"===n?html$1` <${Widget} widgetSpec=${e} />`:"header"===n?html$1`<${Header} headerSpec=${e} />`:"text"===n?html$1`<${TextElement} textSpec=${e} />`:null}const widthToPureClass=[null,"1-12","1-6","1-4","1-3","5-12","1-2","7-12","2-3","3-4","5-6","11-12","1-1"];function WidgetLayout({elements:e}){let n=[],t=0,o=[];for(let c of e)"header"!==c.element_type&&t+c.layout.width<=12&&!c.layout.newline?(n=[...n,c],t+=c.layout.width):(o=[...o,n],t=c.layout.width,n=[c]);return n.length&&(o=[...o,n]),html$1`${o.map((e=>html$1`<div class="pure-g">
        ${e.map((e=>html$1` <div class="pure-u-${widthToPureClass[e.layout.width]}">
            <${ViznoElement} element=${e} />
          </div>`))}
      </div>`))}`}function VizApp({pageTitle:e,dateTime:n,description:t,elements:o}){return html$1`
    <title>${e}</title>
    <div class="vz-body">
      <div class="vz-titlesection">
        <h1>${e}</h1>
        <div class="vz-datetime"><p>${n}</p></div>
      </div>
      ${t?html$1`<div class="vz-report-description">
            <${MarkdownText} text=${t} />
          </div>`:null}
      <div class="vz-widget-body">
        <${WidgetLayout} elements=${o} />
      </div>
    </div>
  `}const{html:html$2,render:render,useEffect:useEffect$2,useRef:useRef$2,useState:useState}=window.htmPreact;function App(){const[e,n]=useState(null),t=useRef$2({}),[o,c]=useState({}),[s,i]=useState({configuration:null,shouldUpdate:!0}),d=useRef$2(!1);return useEffect$2((()=>{if(e){const n=e.get("configurationRequestURL");e.delete("configurationRequestURL"),fetch(`${n}?${e.toString()}`,{headers:{"content-type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>i({shouldUpdate:!1,configuration:e})))}}),[e]),useEffect$2((()=>{if(s.shouldUpdate){if(!d.current)try{const e=new WebSocket("ws://localhost:8000/ws");e.onmessage=()=>{d.current=!0,i({configuration:null,shouldUpdate:!0})},e.onerror=()=>{console.log("No auto update available")}}catch(e){console.log("No auto update available",e)}if(window.location.search){let e=new URLSearchParams(window.location.search);e.has("configurationRequestURL")&&n(e)}else{const e=document.createElement("script");e.src="vizno-config.js",e.type="text/javascript",e.async=!1,e.onload=()=>{i({shouldUpdate:!1,configuration:window.configuration})},document.head.appendChild(e)}}}),[s]),s.configuration?html$2` <${DependencyLoader.Provider} value=${{isLoadingDependencies:t,canRender:o,setCanRender:c}}><${VizApp}
        pageTitle="${s.configuration.title}"
        dateTime=${s.configuration.datetime}
        description=${s.configuration.description}
        elements=${s.configuration.elements}
      /></${DependencyLoader}>`:html$2`Loading configuration...`}render(html$2` <${App} /> `,document.getElementById("root"));
